import { json } from "@remix-run/node";
import { prisma } from "~/db.server";
import { BlogPost } from "./blog-post";
import { generateMetaTags, generateCanonicalUrl } from "~/utils/seo";

export const loader = async ({ params }) => {
  const { articleId } = params;
  const article = await prisma.article.findUnique({
    where: { id: articleId },
    include: {
    
      products: {
        orderBy: {
          position: "asc",
        },
      },
    },
    
  });

if (!article) {
throw new Response("Article not found", { status: 404 });
}

console.log("article loader");

return json({ article });
};

export const handle = {
  breadcrumb: () => (
    <Link to="/blog/markdown-and-mdx">{frontmatter.title}</Link>
  ),
};

export const meta = ({ location, data }) => {
  const canonicalUrl = generateCanonicalUrl(location.pathname);
  return [
    ...generateMetaTags({
      title: data.article.title,
      url: canonicalUrl,
      type: "article",
      publishedTime: data.article.createdAt,
    }),
  ];
};

<BlogPost />
